generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//
// =============================
// ENUMS
// =============================
//

enum UserRole {
  ADMIN
  TEACHER
  STUDENT
}

enum SessionStatus {
  UPCOMING
  ACTIVE
  DONE
  CANCELLED
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  LATE
}

//
// =============================
// MODELS
// =============================
//

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  fullName  String
  role      UserRole @default(STUDENT)

  classesTeaching Class[]      @relation("TeacherClasses")
  enrollments     Enrollment[]
  attendances     Attendance[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Class {
  id          String   @id @default(cuid())
  name        String
  description String?
  capacity    Int
  duration    Int       // minutes

  teacherId String?
  teacher   User?    @relation("TeacherClasses", fields: [teacherId], references: [id])

  sessions    Session[]
  enrollments Enrollment[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Session {
  id        String         @id @default(cuid())
  classId   String
  class     Class          @relation(fields: [classId], references: [id])
  startTime DateTime
  endTime   DateTime
  status    SessionStatus  @default(UPCOMING)

  attendances Attendance[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Enrollment {
  id        String  @id @default(cuid())
  studentId String
  classId   String

  student User  @relation(fields: [studentId], references: [id])
  class   Class @relation(fields: [classId], references: [id])

  createdAt DateTime @default(now())

  @@unique([studentId, classId])
}

model Attendance {
  id        String            @id @default(cuid())
  sessionId String
  studentId String
  status    AttendanceStatus

  session Session @relation(fields: [sessionId], references: [id])
  student User    @relation(fields: [studentId], references: [id])

  checkedInAt DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([sessionId, studentId])
}
